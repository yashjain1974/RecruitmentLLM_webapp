<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brainlox App</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400&family=Roboto&display=swap");

    body {
      background-color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      margin: auto;
      max-width: 1280px;
      font-family: "Nunito Sans", sans-serif;
      letter-spacing: 0.025em;
    }

    nav {
      padding: 1rem;
      border-bottom: 1px solid;
      border-color: #e1e7f0;
      display: flex;
      justify-content: space-between;
      gap: 50vw;
    }

    nav .nav-text {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .container {
      margin: 1rem;
      padding: 1rem;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0px 8px 8px #00000029;
      height: 70vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow-y: scroll;
    }

    .message-container {
      display: flex;
      flex-direction: column;
    }

    .message {
      background-color: white;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
    }

    .head {
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
    }

    .message p {
      margin: 0;
    }

    .user-message {
      background-color: #b5cfff;
      align-self: flex-end;
    }

    .answer-message {
      background-color: #f5f5f5;
    }

    .source-message {
      background-color: #ddfcc3;
    }

    .input-container {
      display: flex;
      margin-top: 20px;
    }

    .input-container input[type="text"] {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 4px;
    }

    .input-container button {
      padding: 10px 20px;
      background-color: #4caf50;
      border: none;
      color: #ffffff;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
    }

    .footer {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      padding: 2rem 1rem;
      gap: 1rem;
    }
  </style>
</head>

<body>

  <nav>
    <div class="nav-text">Home</div>
    <img src="../static/images/brainlox_logo_without_bg.png" alt="logo" style="width: 8rem;">
  </nav>

  <div class="container">
    <div class="message-container" id="message-container">
      <div class="message">
        <div class="head"><span style="color: #310036">Welcome to Active Ride Inventory Bot</span> 
          <!-- <p style="color: #2f5814">Below Bot is trained on retail csv dataset which contains sales data</p> -->
          <span style="color: #ff001b">Enter your question below</span></div>
      </div>
    </div>
    <div class="input-container">
      <input type="text" id="question-input" placeholder="Enter your question" onkeydown="handleKeyDown(event)">
      <button onclick="submitQuestion()">Submit</button>
    </div>
  </div>

  <div class="footer">
    Powered by <a href="https://brainlox.ai/">brainlox.ai</a>
  </div>

  <script>
   var questionInput = document.getElementById("question-input");
var submitButton = document.querySelector(".input-container button");

function handleKeyDown(event) {
  if (event.keyCode === 13) {
    event.preventDefault();
    submitQuestion();
  }
}

function submitQuestion() {
  var question = questionInput.value;

  if (question.trim() === "") {
    return;
  }
  displayMessage(question, "user-message");

  questionInput.value = "";
  // questionInput.disabled = true;
  // submitButton.disabled = true;

  var xhr = new XMLHttpRequest();
  xhr.open("POST", "/process_pdf", true);
  xhr.setRequestHeader("Content-Type", "application/json");

  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4) {
      if (xhr.status === 200) {
        var response = JSON.parse(xhr.responseText);
        
        displayMessage(response.answer, "answer-message");
        displaySources(response.sources);
      }

      questionInput.disabled = false;
      submitButton.disabled = false;
      questionInput.focus();
      questionInput.addEventListener("keydown", handleKeyDown); // Add the event listener again
    }
  };

  questionInput.removeEventListener("keydown", handleKeyDown); // Remove the event listener temporarily
  var data = JSON.stringify({ "question": question });
  xhr.send(data);
}

// Add the event listener for the keydown event
questionInput.addEventListener("keydown", handleKeyDown);

    function displayMessage(message, className) {
      var messageContainer = document.getElementById("message-container");
      var messageElement = document.createElement("div");
      messageElement.classList.add("message", className);
      messageElement.innerHTML = "<p>" + message + "</p>";
      messageContainer.appendChild(messageElement);
    }

    function displaySources(sources) {
      var messageContainer = document.getElementById("message-container");
      var sourceMessage = document.createElement("div");
      sourceMessage.classList.add("message", "source-message");

      var sourcesArray = sources.split(","); // Split the sources string into an array

      var sourcesParagraph = document.createElement("p");
      sourcesParagraph.textContent = "Sources:";
      sourceMessage.appendChild(sourcesParagraph);

      var sourcesList = document.createElement("ul"); // Create an unordered list element

      sourcesArray.forEach(function (source) {
        var listItem = document.createElement("li"); // Create a list item element
        var link = document.createElement("a"); // Create an anchor element

        link.href = source;
        link.target = "_blank";
        link.textContent = source;

        listItem.appendChild(link); // Append the anchor element to the list item
        sourcesList.appendChild(listItem); // Append the list item to the sources list
      });

      sourceMessage.appendChild(sourcesList); // Append the sources list to the source message
      messageContainer.appendChild(sourceMessage);
    }
  </script>
</body>

</html>